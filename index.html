<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Bitcoin Chart Academy</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://unpkg.com/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
      color: #e2e8f0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow-x: hidden;
      touch-action: manipulation;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .floating-card {
      background: rgba(30, 41, 59, 0.9);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .pattern-card {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
      border: 1px solid rgba(34, 197, 94, 0.3);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .pattern-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(34, 197, 94, 0.2);
      border-color: rgba(34, 197, 94, 0.5);
    }
    
    .pattern-card.highlighted {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
      border-color: rgba(34, 197, 94, 0.6);
    }
    
    .indicator-card {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
      border: 1px solid rgba(139, 92, 246, 0.3);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .indicator-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.2);
      border-color: rgba(139, 92, 246, 0.5);
    }
    
    .indicator-card.highlighted {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
      border-color: rgba(139, 92, 246, 0.6);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
      transform: translateY(-1px);
    }
    
    .btn-primary.active {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
      background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
      transform: translateY(-1px);
    }
    
    .btn-quiz {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      transition: all 0.3s ease;
    }
    
    .btn-quiz:hover {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
      transform: translateY(-1px);
    }
    
    .btn-trading {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      transition: all 0.3s ease;
    }
    
    .btn-trading:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      transform: translateY(-1px);
    }
    
    .btn-trading.active {
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
    }
    
    .sidebar-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      background: rgba(59, 130, 246, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      color: white;
    }
    
    .sidebar-toggle:hover {
      background: rgba(59, 130, 246, 1);
      transform: scale(1.1);
    }
    
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 999;
      display: none;
    }
    
    .sidebar-mobile {
      position: fixed;
      top: 0;
      left: -100%;
      width: 85%;
      max-width: 400px;
      height: 100vh;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      z-index: 1000;
      transition: left 0.3s ease;
      overflow-y: auto;
      border-right: 1px solid rgba(148, 163, 184, 0.2);
    }
    
    .sidebar-mobile.open {
      left: 0;
    }
    
    .tooltip {
      position: absolute;
      pointer-events: none;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      font-size: 12px;
      padding: 8px 12px;
      border-radius: 8px;
      display: none;
      z-index: 1000;
      border: 1px solid rgba(59, 130, 246, 0.3);
      backdrop-filter: blur(10px);
      max-width: 250px;
    }
    
    .support-resistance-panel {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 12px;
      padding: 16px;
      font-size: 12px;
      color: #e2e8f0;
      display: none;
      min-width: 140px;
      z-index: 1000;
    }
    
    .level-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: 500;
    }
    
    .level-item.support {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }
    
    .level-item.resistance {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }
    
    .quiz-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    
    .quiz-panel {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(59, 130, 246, 0.3);
      border-radius: 16px;
      padding: 30px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
    }
    
    .quiz-option {
      background: rgba(51, 65, 85, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: #e2e8f0;
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 8px;
    }
    
    .quiz-option:hover {
      background: rgba(71, 85, 105, 0.8);
      border-color: rgba(59, 130, 246, 0.5);
      transform: translateY(-1px);
    }
    
    .quiz-option.correct {
      background: rgba(34, 197, 94, 0.3);
      border-color: #22c55e;
      color: #dcfce7;
    }
    
    .quiz-option.incorrect {
      background: rgba(239, 68, 68, 0.3);
      border-color: #ef4444;
      color: #fecaca;
    }
    
    .trading-panel {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      border-top: 2px solid rgba(59, 130, 246, 0.3);
      padding: 20px;
      display: none;
    }
    
    .balance-display {
      font-size: 18px;
      font-weight: 700;
      color: #3b82f6;
      text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
    }
    
    .position-display {
      font-size: 14px;
      color: #94a3b8;
      font-weight: 500;
    }
    
    .trade-btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      color: white;
      min-width: 120px;
    }
    
    .trade-btn.buy {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    }
    
    .trade-btn.buy:hover {
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
      transform: translateY(-1px);
    }
    
    .trade-btn.sell {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
    
    .trade-btn.sell:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      transform: translateY(-1px);
    }
    
    .trade-btn.close {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }
    
    .trade-btn.close:hover {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
      transform: translateY(-1px);
    }
    
    .trade-btn:disabled {
      background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
      cursor: not-allowed;
      opacity: 0.5;
      transform: none;
    }
    
    .glossary-term {
      background: rgba(71, 85, 105, 0.3);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      transition: all 0.3s ease;
    }
    
    .glossary-term:hover {
      background: rgba(71, 85, 105, 0.5);
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    .indicator-values {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(20px);
      padding: 12px;
      border-radius: 8px;
      font-size: 12px;
      color: #e2e8f0;
      display: none;
      border: 1px solid rgba(148, 163, 184, 0.2);
    }
    
    .external-link {
      display: block;
      color: #3b82f6;
      text-decoration: none;
      font-size: 12px;
      margin-bottom: 8px;
      padding: 8px 12px;
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 6px;
      transition: all 0.3s ease;
    }
    
    .external-link:hover {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.4);
      transform: translateY(-1px);
    }
    
    .loading-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #3b82f6;
      font-size: 18px;
      font-weight: 600;
      display: none;
      text-align: center;
    }
    
    .pnl-positive {
      color: #22c55e !important;
      text-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
    }
    
    .pnl-negative {
      color: #ef4444 !important;
      text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
    }
    
    .control-chip {
      background: rgba(71, 85, 105, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.3);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #e2e8f0;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .control-chip:hover {
      background: rgba(71, 85, 105, 0.8);
      border-color: rgba(59, 130, 246, 0.5);
      transform: translateY(-1px);
    }
    
    .control-chip.active {
      background: rgba(59, 130, 246, 0.8);
      border-color: #3b82f6;
      color: white;
    }
    
    .section-header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 12px;
      font-weight: 600;
      font-size: 14px;
      color: #3b82f6;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    @media (max-width: 768px) {
      .sidebar-toggle {
        display: flex;
      }
      
      .desktop-sidebar {
        display: none;
      }
      
      .chart-container {
        height: calc(100vh - 140px) !important;
      }
      
      .controls-mobile {
        padding: 12px;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      }
      
      .trading-panel {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        border-top: 2px solid rgba(59, 130, 246, 0.3);
        border-radius: 16px 16px 0 0;
        max-height: 50vh;
        overflow-y: auto;
      }
    }
    
    @media (min-width: 769px) {
      .sidebar-toggle {
        display: none;
      }
      
      .sidebar-mobile {
        display: none;
      }
      
      .desktop-sidebar {
        display: flex;
      }
    }
    
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .5;
      }
    }
  </style>
</head>
<body>
  <!-- Mobile Sidebar Toggle -->
  <div class="sidebar-toggle" id="sidebar-toggle">
    <i class="fas fa-bars"></i>
  </div>
  
  <!-- Mobile Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebar-overlay"></div>
  
  <!-- Header -->
  <header class="gradient-bg text-white py-4 px-6 shadow-lg">
    <div class="flex items-center justify-center">
      <div class="flex items-center space-x-3">
        <i class="fas fa-chart-line text-2xl"></i>
        <h1 class="text-2xl font-bold">Bitcoin Chart Academy</h1>
        <i class="fas fa-rocket text-2xl"></i>
      </div>
    </div>
  </header>
  
  <div class="flex h-screen">
    <!-- Desktop Sidebar -->
    <div class="desktop-sidebar w-80 bg-gray-900 border-r border-gray-700 overflow-y-auto">
      <div class="p-6 space-y-6">
        <!-- Chart Patterns Section -->
        <div class="floating-card rounded-lg p-4">
          <div class="section-header">
            <i class="fas fa-chart-bar"></i>
            <span>Chart Patterns</span>
          </div>
          <div id="patterns-list" class="space-y-3"></div>
        </div>
        
        <!-- Technical Indicators Section -->
        <div class="floating-card rounded-lg p-4">
          <div class="section-header">
            <i class="fas fa-chart-line"></i>
            <span>Technical Indicators</span>
          </div>
          <div id="indicators-list" class="space-y-3"></div>
        </div>
        
        <!-- Trading Glossary Section -->
        <div class="floating-card rounded-lg p-4">
          <div class="section-header">
            <i class="fas fa-book"></i>
            <span>Trading Glossary</span>
          </div>
          <div id="glossary-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
        </div>
        
        <!-- Learning Resources Section -->
        <div class="floating-card rounded-lg p-4">
          <div class="section-header">
            <i class="fas fa-graduation-cap"></i>
            <span>Learning Resources</span>
          </div>
          <div class="external-links space-y-2">
            <a href="https://www.investopedia.com/technical-analysis-4689657" target="_blank" class="external-link">
              <i class="fas fa-book-open mr-2"></i>Technical Analysis Guide
            </a>
            <a href="https://www.tradingview.com/chart/" target="_blank" class="external-link">
              <i class="fas fa-chart-area mr-2"></i>TradingView Charts
            </a>
            <a href="https://academy.binance.com/en/articles/a-complete-guide-to-cryptocurrency-trading-for-beginners" target="_blank" class="external-link">
              <i class="fas fa-university mr-2"></i>Binance Academy
            </a>
            <a href="https://www.youtube.com/watch?v=8T_cOGGl8kE" target="_blank" class="external-link">
              <i class="fas fa-video mr-2"></i>Candlestick Patterns
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mobile Sidebar -->
    <div class="sidebar-mobile" id="sidebar-mobile">
      <div class="p-6 space-y-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-bold text-blue-400">Menu</h2>
          <button id="close-sidebar" class="text-gray-400 hover:text-white">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        
        <!-- Mobile Chart Patterns Section -->
        <div class="floating-card rounded-lg p-4">
          <div class="section-header">
            <i class="fas fa-chart-bar"></i>
            <span>Chart Patterns</span>
          </div>
          <div id="patterns-list-mobile" class="space-y-3"></div>
        </div>
        
        <!-- Mobile Technical Indicators Section -->
        <div class="floating-card rounded-lg p-4">
          <div class="section-header">
            <i class="fas fa-chart-line"></i>
            <span>Technical Indicators</span>
          </div>
          <div id="indicators-list-mobile" class="space-y-3"></div>
        </div>
        
        <!-- Mobile Trading Glossary Section -->
        <div class="floating-card rounded-lg p-4">
          <div class="section-header">
            <i class="fas fa-book"></i>
            <span>Trading Glossary</span>
          </div>
          <div id="glossary-list-mobile" class="space-y-2 max-h-60 overflow-y-auto"></div>
        </div>
        
        <!-- Mobile Learning Resources Section -->
        <div class="floating-card rounded-lg p-4">
          <div class="section-header">
            <i class="fas fa-graduation-cap"></i>
            <span>Learning Resources</span>
          </div>
          <div class="external-links space-y-2">
            <a href="https://www.investopedia.com/technical-analysis-4689657" target="_blank" class="external-link">
              <i class="fas fa-book-open mr-2"></i>Technical Analysis Guide
            </a>
            <a href="https://www.tradingview.com/chart/" target="_blank" class="external-link">
              <i class="fas fa-chart-area mr-2"></i>TradingView Charts
            </a>
            <a href="https://academy.binance.com/en/articles/a-complete-guide-to-cryptocurrency-trading-for-beginners" target="_blank" class="external-link">
              <i class="fas fa-university mr-2"></i>Binance Academy
            </a>
            <a href="https://www.youtube.com/watch?v=8T_cOGGl8kE" target="_blank" class="external-link">
              <i class="fas fa-video mr-2"></i>Candlestick Patterns
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Chart Area -->
    <div class="flex-1 flex flex-col">
      <!-- Controls -->
      <div class="controls-mobile bg-gray-900 p-4 border-b border-gray-700">
        <div class="flex flex-wrap gap-2 items-center justify-center">
          <div class="flex items-center space-x-2">
            <label class="text-sm text-gray-400">Timeframe:</label>
            <select id="timeframe-select" class="bg-gray-800 text-white border border-gray-600 rounded px-2 py-1 text-sm">
              <option value="1m">1 Minute</option>
              <option value="5m">5 Minutes</option>
              <option value="15m">15 Minutes</option>
              <option value="1h" selected>1 Hour</option>
              <option value="4h">4 Hours</option>
              <option value="1d">1 Day</option>
            </select>
          </div>
          
          <div class="flex items-center space-x-2">
            <label class="text-sm text-gray-400">Colors:</label>
            <input type="color" id="bull-color" value="#26a69a" class="w-8 h-8 rounded border border-gray-600" title="Bullish Candle Color">
            <input type="color" id="bear-color" value="#ef5350" class="w-8 h-8 rounded border border-gray-600" title="Bearish Candle Color">
          </div>
        </div>
        
        <div class="flex flex-wrap gap-2 mt-4 justify-center">
          <button class="control-chip" id="toggle-patterns">
            <i class="fas fa-map-pin"></i>
            <span>Patterns</span>
          </button>
          <button class="control-chip" id="toggle-swing-points">
            <i class="fas fa-mountain"></i>
            <span>HH/LL/LH/HL</span>
          </button>
          <button class="control-chip" id="toggle-support-resistance">
            <i class="fas fa-crosshairs"></i>
            <span>Support/Resistance</span>
          </button>
          <button class="control-chip" id="toggle-ma">
            <i class="fas fa-chart-line"></i>
            <span>MA</span>
          </button>
          <button class="control-chip" id="toggle-volume">
            <i class="fas fa-chart-bar"></i>
            <span>Volume</span>
          </button>
          <button class="control-chip" id="toggle-rsi">
            <i class="fas fa-bolt"></i>
            <span>RSI</span>
          </button>
          <button class="control-chip" id="toggle-macd">
            <i class="fas fa-water"></i>
            <span>MACD</span>
          </button>
          <button class="control-chip" id="toggle-bollinger">
            <i class="fas fa-ruler"></i>
            <span>Bollinger</span>
          </button>
        </div>
        
        <div class="flex flex-wrap gap-2 mt-4 justify-center">
          <button class="btn-quiz control-chip" id="quiz-mode-btn">
            <i class="fas fa-question-circle"></i>
            <span>Quiz Mode</span>
          </button>
          <button class="btn-trading control-chip" id="toggle-trading">
            <i class="fas fa-coins"></i>
            <span>Paper Trading</span>
          </button>
          <button class="btn-secondary control-chip" id="save-settings">
            <i class="fas fa-save"></i>
            <span>Save</span>
          </button>
          <button class="btn-secondary control-chip" id="refresh-data">
            <i class="fas fa-sync-alt"></i>
            <span>Refresh</span>
          </button>
        </div>
      </div>
      
      <!-- Chart Container -->
      <div class="chart-container flex-1 relative bg-gray-900" id="chart-container">
        <div id="chart" class="w-full h-full"></div>
        <div class="loading-indicator animate-pulse" id="loading-indicator">
          <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
          <div>Loading chart data...</div>
        </div>
        <div class="tooltip" id="tooltip"></div>
        <div class="indicator-values" id="indicator-values"></div>
        <div class="support-resistance-panel" id="support-resistance-panel">
          <h4 class="text-center text-blue-400 font-semibold mb-2">Key Levels</h4>
          <div id="levels-list"></div>
        </div>
      </div>
      
      <!-- Trading Panel -->
      <div class="trading-panel" id="trading-panel">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
          <div class="text-center">
            <div class="text-sm text-gray-400">Balance</div>
            <div class="balance-display">$<span id="balance">10000.00</span></div>
          </div>
          <div class="text-center">
            <div class="text-sm text-gray-400">Position</div>
            <div class="position-display" id="position">None</div>
          </div>
          <div class="text-center">
            <div class="text-sm text-gray-400">Entry Price</div>
            <div class="position-display">$<span id="entry-price">0.00</span></div>
          </div>
          <div class="text-center">
            <div class="text-sm text-gray-400">P&L</div>
            <div class="position-display">$<span id="pnl">0.00</span></div>
          </div>
        </div>
        <div class="flex flex-wrap gap-3 justify-center">
          <button class="trade-btn buy" id="buy-btn">
            <i class="fas fa-arrow-up mr-2"></i>Buy Long
          </button>
          <button class="trade-btn sell" id="sell-btn">
            <i class="fas fa-arrow-down mr-2"></i>Sell Short
          </button>
          <button class="trade-btn close" id="close-position-btn" disabled>
            <i class="fas fa-times mr-2"></i>Close Position
          </button>
          <button class="trade-btn btn-secondary" id="reset-trading">
            <i class="fas fa-undo mr-2"></i>Reset Account
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Quiz Overlay -->
  <div class="quiz-overlay" id="quiz-overlay">
    <div class="quiz-panel">
      <div class="text-2xl font-bold text-blue-400 mb-6" id="quiz-question"></div>
      <div class="space-y-3 mb-6" id="quiz-options"></div>
      <div class="flex space-x-4 justify-center">
        <button class="btn-primary px-6 py-2 rounded-lg" id="next-quiz">
          <i class="fas fa-arrow-right mr-2"></i>Next Question
        </button>
        <button class="btn-secondary px-6 py-2 rounded-lg" id="exit-quiz">
          <i class="fas fa-times mr-2"></i>Exit Quiz
        </button>
      </div>
    </div>
  </div>

  <script>
    // Enhanced Bitcoin Chart Academy with improved mobile UI
    class BitcoinChartAcademy {
      constructor() {
        this.chart = null;
        this.candleSeries = null;
        this.volumeSeries = null;
        this.ma50Series = null;
        this.ma200Series = null;
        this.rsiSeries = null;
        this.macdSeries = null;
        this.bollingerUpperSeries = null;
        this.bollingerLowerSeries = null;
        this.supportLineSeries = [];
        this.resistanceLineSeries = [];
        
        this.candlesData = [];
        this.patterns = [];
        this.swingPoints = [];
        this.supportLevels = [];
        this.resistanceLevels = [];
        this.quizMode = false;
        this.currentQuiz = null;
        this.settings = this.loadSettings();
        
        // Paper trading
        this.balance = 10000;
        this.position = null;
        this.entryPrice = 0;
        this.positionSize = 0;
        this.tradingActive = false;
        
        this.init();
      }
      
      init() {
        this.setupChart();
        this.setupEventListeners();
        this.setupMobileUI();
        this.loadPatternDefinitions();
        this.loadIndicatorDefinitions();
        this.loadGlossary();
        this.applySettings();
        this.fetchData();
      }
      
      setupMobileUI() {
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarMobile = document.getElementById('sidebar-mobile');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const closeSidebar = document.getElementById('close-sidebar');
        
        sidebarToggle.addEventListener('click', () => {
          sidebarMobile.classList.add('open');
          sidebarOverlay.style.display = 'block';
        });
        
        const closeSidebarFn = () => {
          sidebarMobile.classList.remove('open');
          sidebarOverlay.style.display = 'none';
        };
        
        closeSidebar.addEventListener('click', closeSidebarFn);
        sidebarOverlay.addEventListener('click', closeSidebarFn);
        
        // Handle window resize
        window.addEventListener('resize', () => {
          if (window.innerWidth > 768) {
            closeSidebarFn();
          }
          this.chart.applyOptions({
            width: document.getElementById('chart').offsetWidth,
            height: document.getElementById('chart').offsetHeight
          });
        });
      }
      
      setupChart() {
        const chartEl = document.getElementById('chart');
        
        this.chart = LightweightCharts.createChart(chartEl, {
          width: chartEl.offsetWidth,
          height: chartEl.offsetHeight,
          layout: {
            background: { color: '#111827' },
            textColor: '#e5e7eb'
          },
          grid: {
            vertLines: { color: '#374151' },
            horzLines: { color: '#374151' }
          },
          timeScale: {
            timeVisible: true,
            barSpacing: 8,
            minBarSpacing: 4,
            borderColor: '#4b5563'
          },
          rightPriceScale: {
            borderColor: '#4b5563'
          },
          crosshair: {
            mode: 1,
            vertLine: {
              width: 1,
              color: 'rgba(59, 130, 246, 0.5)',
              style: 1
            },
            horzLine: {
              width: 1,
              color: 'rgba(59, 130, 246, 0.5)',
              style: 1
            }
          }
        });
        
        // Main candlestick series
        this.candleSeries = this.chart.addCandlestickSeries({
          upColor: this.settings.bullColor || '#10b981',
          downColor: this.settings.bearColor || '#ef4444',
          borderUpColor: this.settings.bullColor || '#10b981',
          borderDownColor: this.settings.bearColor || '#ef4444',
          wickUpColor: this.settings.bullColor || '#10b981',
          wickDownColor: this.settings.bearColor || '#ef4444'
        });
        
        // Volume series
        this.volumeSeries = this.chart.addHistogramSeries({
          color: '#6b7280',
          priceFormat: { type: 'volume' },
          priceScaleId: 'volume',
          scaleMargins: { top: 0.8, bottom: 0 }
        });
        
        // Moving averages
        this.ma50Series = this.chart.addLineSeries({
          color: '#3b82f6',
          lineWidth: 2,
          crossHairMarkerVisible: false,
          lastValueVisible: false
        });
        
        this.ma200Series = this.chart.addLineSeries({
          color: '#ef4444',
          lineWidth: 2,
          crossHairMarkerVisible: false,
          lastValueVisible: false
        });
        
        // RSI series
        this.rsiSeries = this.chart.addLineSeries({
          color: '#f59e0b',
          lineWidth: 2,
          priceScaleId: 'rsi',
          scaleMargins: { top: 0.1, bottom: 0.8 }
        });
        
        // MACD series
        this.macdSeries = this.chart.addLineSeries({
          color: '#8b5cf6',
          lineWidth: 2,
          priceScaleId: 'macd',
          scaleMargins: { top: 0.6, bottom: 0.1 }
        });
        
        // Bollinger Bands
        this.bollingerUpperSeries = this.chart.addLineSeries({
          color: 'rgba(251, 191, 36, 0.5)',
          lineWidth: 1,
          crossHairMarkerVisible: false
        });
        
        this.bollingerLowerSeries = this.chart.addLineSeries({
          color: 'rgba(251, 191, 36, 0.5)',
          lineWidth: 1,
          crossHairMarkerVisible: false
        });
        
        // Chart event listeners
        this.chart.subscribeCrosshairMove(this.onCrosshairMove.bind(this));
        this.chart.subscribeClick(this.onChartClick.bind(this));
        
        // Hide indicators initially
        this.toggleIndicator('ma', false);
        this.toggleIndicator('volume', false);
        this.toggleIndicator('rsi', false);
        this.toggleIndicator('macd', false);
        this.toggleIndicator('bollinger', false);
      }
      
      setupEventListeners() {
        // Timeframe selection
        document.getElementById('timeframe-select').addEventListener('change', (e) => {
          this.settings.timeframe = e.target.value;
          this.fetchData();
        });
        
        // Color customization
        document.getElementById('bull-color').addEventListener('change', (e) => {
          this.settings.bullColor = e.target.value;
          this.updateCandleColors();
        });
        
        document.getElementById('bear-color').addEventListener('change', (e) => {
          this.settings.bearColor = e.target.value;
          this.updateCandleColors();
        });
        
        // Toggle buttons
        document.getElementById('toggle-patterns').addEventListener('click', () => {
          this.togglePatterns();
        });
        
        document.getElementById('toggle-swing-points').addEventListener('click', () => {
          this.toggleSwingPoints();
        });
        
        document.getElementById('toggle-support-resistance').addEventListener('click', () => {
          this.toggleSupportResistance();
        });
        
        document.getElementById('toggle-ma').addEventListener('click', () => {
          this.toggleIndicator('ma');
        });
        
        document.getElementById('toggle-volume').addEventListener('click', () => {
          this.toggleIndicator('volume');
        });
        
        document.getElementById('toggle-rsi').addEventListener('click', () => {
          this.toggleIndicator('rsi');
        });
        
        document.getElementById('toggle-macd').addEventListener('click', () => {
          this.toggleIndicator('macd');
        });
        
        document.getElementById('toggle-bollinger').addEventListener('click', () => {
          this.toggleIndicator('bollinger');
        });
        
        // Quiz mode
        document.getElementById('quiz-mode-btn').addEventListener('click', () => {
          this.toggleQuizMode();
        });
        
        document.getElementById('next-quiz').addEventListener('click', () => {
          this.nextQuizQuestion();
        });
        
        document.getElementById('exit-quiz').addEventListener('click', () => {
          this.exitQuizMode();
        });
        
        // Paper trading
        document.getElementById('toggle-trading').addEventListener('click', () => {
          this.toggleTradingPanel();
        });
        
        document.getElementById('buy-btn').addEventListener('click', () => {
          this.executeTrade('long');
        });
        
        document.getElementById('sell-btn').addEventListener('click', () => {
          this.executeTrade('short');
        });
        
        document.getElementById('close-position-btn').addEventListener('click', () => {
          this.closePosition();
        });
        
        document.getElementById('reset-trading').addEventListener('click', () => {
          this.resetTradingAccount();
        });
        
        // Save settings
        document.getElementById('save-settings').addEventListener('click', () => {
          this.saveSettings();
        });
        
        // Refresh data
        document.getElementById('refresh-data').addEventListener('click', () => {
          this.fetchData();
        });
      }
      
      async fetchData() {
        try {
          this.showLoading(true);
          const timeframe = this.settings.timeframe || '1h';
          const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${timeframe}&limit=500`);
          const data = await response.json();
          
          this.candlesData = data.map(d => ({
            time: Math.floor(d[0] / 1000),
            open: parseFloat(d[1]),
            high: parseFloat(d[2]),
            low: parseFloat(d[3]),
            close: parseFloat(d[4]),
            volume: parseFloat(d[5])
          }));
          
          this.updateChart();
          this.detectPatterns();
          this.detectSwingPoints();
          this.detectSupportResistance();
          this.calculateIndicators();
          this.updateTradingDisplay();
          this.showLoading(false);
          
        } catch (error) {
          console.error('Error fetching data:', error);
          this.showLoading(false);
          this.showAlert('Failed to load chart data. Please check your internet connection and try again.', 'error');
        }
      }
      
      showLoading(show) {
        const loadingIndicator = document.getElementById('loading-indicator');
        loadingIndicator.style.display = show ? 'block' : 'none';
      }
      
      showAlert(message, type = 'info') {
        // Create modern alert
        const alertDiv = document.createElement('div');
        alertDiv.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
          type === 'error' ? 'bg-red-500' : type === 'success' ? 'bg-green-500' : 'bg-blue-500'
        } text-white`;
        alertDiv.innerHTML = `
          <div class="flex items-center">
            <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'} mr-3"></i>
            <span>${message}</span>
          </div>
        `;
        
        document.body.appendChild(alertDiv);
        
        setTimeout(() => {
          alertDiv.remove();
        }, 3000);
      }
      
      updateChart() {
        this.candleSeries.setData(this.candlesData);
        
        // Volume data
        const volumeData = this.candlesData.map(c => ({
          time: c.time,
          value: c.volume,
          color: c.close > c.open ? 'rgba(16, 185, 129, 0.5)' : 'rgba(239, 68, 68, 0.5)'
        }));
        this.volumeSeries.setData(volumeData);
      }
      
      calculateIndicators() {
        // Moving Averages
        const ma50 = this.calculateMA(this.candlesData, 50);
        const ma200 = this.calculateMA(this.candlesData, 200);
        this.ma50Series.setData(ma50);
        this.ma200Series.setData(ma200);
        
        // RSI
        const rsi = this.calculateRSI(this.candlesData, 14);
        this.rsiSeries.setData(rsi);
        
        // MACD
        const macd = this.calculateMACD(this.candlesData);
        this.macdSeries.setData(macd);
        
        // Bollinger Bands
        const bollinger = this.calculateBollingerBands(this.candlesData, 20, 2);
        this.bollingerUpperSeries.setData(bollinger.upper);
        this.bollingerLowerSeries.setData(bollinger.lower);
      }
      
      calculateMA(data, period) {
        return data.map((candle, index) => {
          if (index < period - 1) return { time: candle.time, value: null };
          const sum = data.slice(index - period + 1, index + 1).reduce((a, b) => a + b.close, 0);
          return { time: candle.time, value: sum / period };
        }).filter(item => item.value !== null);
      }
      
      calculateRSI(data, period) {
        const rsi = [];
        let gains = 0;
        let losses = 0;
        
        for (let i = 1; i < data.length; i++) {
          const change = data[i].close - data[i - 1].close;
          
          if (i <= period) {
            if (change > 0) gains += change;
            else losses -= change;
            
            if (i === period) {
              const avgGain = gains / period;
              const avgLoss = losses / period;
              const rs = avgGain / avgLoss;
              const rsiValue = 100 - (100 / (1 + rs));
              rsi.push({ time: data[i].time, value: rsiValue });
            }
          } else {
            const prevAvgGain = gains / period;
            const prevAvgLoss = losses / period;
            
            const currentGain = change > 0 ? change : 0;
            const currentLoss = change < 0 ? -change : 0;
            
            const avgGain = (prevAvgGain * (period - 1) + currentGain) / period;
            const avgLoss = (prevAvgLoss * (period - 1) + currentLoss) / period;
            
            const rs = avgGain / avgLoss;
            const rsiValue = 100 - (100 / (1 + rs));
            rsi.push({ time: data[i].time, value: rsiValue });
            
            gains = avgGain * period;
            losses = avgLoss * period;
          }
        }
        
        return rsi;
      }
      
      calculateMACD(data) {
        const ema12 = this.calculateEMA(data, 12);
        const ema26 = this.calculateEMA(data, 26);
        
        const macd = [];
        for (let i = 0; i < Math.min(ema12.length, ema26.length); i++) {
          if (ema12[i].value !== null && ema26[i].value !== null) {
            macd.push({
              time: ema12[i].time,
              value: ema12[i].value - ema26[i].value
            });
          }
        }
        
        return macd;
      }
      
      calculateEMA(data, period) {
        const ema = [];
        const multiplier = 2 / (period + 1);
        
        for (let i = 0; i < data.length; i++) {
          if (i === 0) {
            ema.push({ time: data[i].time, value: data[i].close });
          } else {
            const value = (data[i].close - ema[i - 1].value) * multiplier + ema[i - 1].value;
            ema.push({ time: data[i].time, value });
          }
        }
        
        return ema;
      }
      
      calculateBollingerBands(data, period, stdDev) {
        const sma = this.calculateMA(data, period);
        const upper = [];
        const lower = [];
        
        for (let i = period - 1; i < data.length; i++) {
          const slice = data.slice(i - period + 1, i + 1);
          const mean = slice.reduce((sum, candle) => sum + candle.close, 0) / period;
          const variance = slice.reduce((sum, candle) => sum + Math.pow(candle.close - mean, 2), 0) / period;
          const standardDeviation = Math.sqrt(variance);
          
          upper.push({
            time: data[i].time,
            value: mean + (standardDeviation * stdDev)
          });
          
          lower.push({
            time: data[i].time,
            value: mean - (standardDeviation * stdDev)
          });
        }
        
        return { upper, lower };
      }
      
      detectPatterns() {
        this.patterns = [];
        
        for (let i = 2; i < this.candlesData.length - 1; i++) {
          const prev = this.candlesData[i - 1];
          const curr = this.candlesData[i];
          const next = this.candlesData[i + 1];
          
          // Pattern detection logic
          this.detectDoji(curr, i);
          this.detectEngulfing(prev, curr, i);
          this.detectHammer(curr, i);
          this.detectShootingStar(curr, i);
        }
        
        this.updatePatternMarkers();
      }
      
      detectDoji(candle, index) {
        const bodySize = Math.abs(candle.close - candle.open);
        const candleSize = candle.high - candle.low;
        
        if (bodySize < 0.1 * candleSize && candleSize > 0) {
          this.patterns.push({
            type: 'doji',
            time: candle.time,
            index: index,
            position: 'aboveBar',
            color: '#fbbf24',
            shape: 'circle',
            text: 'Doji'
          });
        }
      }
      
      detectEngulfing(prev, curr, index) {
        const prevBull = prev.close > prev.open;
        const prevBear = prev.open > prev.close;
        const currBull = curr.close > curr.open;
        const currBear = curr.open > curr.close;
        
        // Bullish engulfing
        if (prevBear && currBull && curr.close > prev.open && curr.open < prev.close) {
          this.patterns.push({
            type: 'bullish_engulfing',
            time: curr.time,
            index: index,
            position: 'belowBar',
            color: '#10b981',
            shape: 'arrowUp',
            text: 'Bullish Engulfing'
          });
        }
        
        // Bearish engulfing
        if (prevBull && currBear && curr.open > prev.close && curr.close < prev.open) {
          this.patterns.push({
            type: 'bearish_engulfing',
            time: curr.time,
            index: index,
            position: 'aboveBar',
            color: '#ef4444',
            shape: 'arrowDown',
            text: 'Bearish Engulfing'
          });
        }
      }
      
      detectHammer(candle, index) {
        const bodySize = Math.abs(candle.close - candle.open);
        const candleSize = candle.high - candle.low;
        const lowerWick = Math.min(candle.open, candle.close) - candle.low;
        
        if (bodySize < candleSize * 0.3 && lowerWick >= bodySize * 2) {
          this.patterns.push({
            type: 'hammer',
            time: candle.time,
            index: index,
            position: 'belowBar',
            color: '#10b981',
            shape: 'arrowUp',
            text: 'Hammer'
          });
        }
      }
      
      detectShootingStar(candle, index) {
        const bodySize = Math.abs(candle.close - candle.open);
        const candleSize = candle.high - candle.low;
        const upperWick = candle.high - Math.max(candle.open, candle.close);
        
        if (bodySize < candleSize * 0.3 && upperWick >= bodySize * 2) {
          this.patterns.push({
            type: 'shooting_star',
            time: candle.time,
            index: index,
            position: 'aboveBar',
            color: '#ef4444',
            shape: 'arrowDown',
            text: 'Shooting Star'
          });
        }
      }
      
      detectSwingPoints() {
        this.swingPoints = [];
        const lookback = 5;
        
        for (let i = lookback; i < this.candlesData.length - lookback; i++) {
          const current = this.candlesData[i];
          
          // Check for Higher High (HH)
          let isHigherHigh = true;
          for (let j = i - lookback; j <= i + lookback; j++) {
            if (j !== i && this.candlesData[j].high >= current.high) {
              isHigherHigh = false;
              break;
            }
          }
          
          if (isHigherHigh) {
            let foundPreviousHigh = false;
            for (let k = Math.max(0, i - 50); k < i - lookback; k++) {
              if (this.candlesData[k].high > current.high * 0.98 && this.candlesData[k].high < current.high) {
                foundPreviousHigh = true;
                break;
              }
            }
            
            if (foundPreviousHigh) {
              this.swingPoints.push({
                type: 'higher_high',
                time: current.time,
                price: current.high,
                position: 'aboveBar',
                color: '#10b981',
                shape: 'circle',
                text: 'HH'
              });
            }
          }
          
          // Check for Lower Low (LL)
          let isLowerLow = true;
          for (let j = i - lookback; j <= i + lookback; j++) {
            if (j !== i && this.candlesData[j].low <= current.low) {
              isLowerLow = false;
              break;
            }
          }
          
          if (isLowerLow) {
            let foundPreviousLow = false;
            for (let k = Math.max(0, i - 50); k < i - lookback; k++) {
              if (this.candlesData[k].low < current.low * 1.02 && this.candlesData[k].low > current.low) {
                foundPreviousLow = true;
                break;
              }
            }
            
            if (foundPreviousLow) {
              this.swingPoints.push({
                type: 'lower_low',
                time: current.time,
                price: current.low,
                position: 'belowBar',
                color: '#ef4444',
                shape: 'circle',
                text: 'LL'
              });
            }
          }
          
          // Check for Lower High (LH)
          if (isHigherHigh) {
            let foundHigherPrevious = false;
            for (let k = Math.max(0, i - 50); k < i - lookback; k++) {
              if (this.candlesData[k].high > current.high) {
                foundHigherPrevious = true;
                break;
              }
            }
            
            if (foundHigherPrevious) {
              this.swingPoints.push({
                type: 'lower_high',
                time: current.time,
                price: current.high,
                position: 'aboveBar',
                color: '#f59e0b',
                shape: 'circle',
                text: 'LH'
              });
            }
          }
          
          // Check for Higher Low (HL)
          if (isLowerLow) {
            let foundLowerPrevious = false;
            for (let k = Math.max(0, i - 50); k < i - lookback; k++) {
              if (this.candlesData[k].low < current.low) {
                foundLowerPrevious = true;
                break;
              }
            }
            
            if (foundLowerPrevious) {
              this.swingPoints.push({
                type: 'higher_low',
                time: current.time,
                price: current.low,
                position: 'belowBar',
                color: '#06b6d4',
                shape: 'circle',
                text: 'HL'
              });
            }
          }
        }
        
        this.updateSwingPointMarkers();
      }
      
      detectSupportResistance() {
        this.supportLevels = [];
        this.resistanceLevels = [];
        
        // Clear existing support/resistance lines
        this.supportLineSeries.forEach(series => this.chart.removeSeries(series));
        this.resistanceLineSeries.forEach(series => this.chart.removeSeries(series));
        this.supportLineSeries = [];
        this.resistanceLineSeries = [];
        
        const tolerance = 0.015;
        const minTouches = 3;
        
        // Collect all highs and lows
        const highs = this.candlesData.map((c, i) => ({ price: c.high, time: c.time, index: i }));
        const lows = this.candlesData.map((c, i) => ({ price: c.low, time: c.time, index: i }));
        
        // Find resistance levels
        const resistanceLevels = this.findSignificantLevels(highs, tolerance, minTouches);
        resistanceLevels.forEach(level => {
          this.resistanceLevels.push(level);
          
          const resistanceLine = this.chart.addLineSeries({
            color: 'rgba(239, 68, 68, 0.7)',
            lineWidth: 2,
            lineStyle: 1,
            crossHairMarkerVisible: false,
            lastValueVisible: true,
            priceLineVisible: false
          });
          
          const lineData = [
            { time: this.candlesData[0].time, value: level.price },
            { time: this.candlesData[this.candlesData.length - 1].time, value: level.price }
          ];
          resistanceLine.setData(lineData);
          this.resistanceLineSeries.push(resistanceLine);
        });
        
        // Find support levels
        const supportLevels = this.findSignificantLevels(lows, tolerance, minTouches);
        supportLevels.forEach(level => {
          this.supportLevels.push(level);
          
          const supportLine = this.chart.addLineSeries({
            color: 'rgba(34, 197, 94, 0.7)',
            lineWidth: 2,
            lineStyle: 1,
            crossHairMarkerVisible: false,
            lastValueVisible: true,
            priceLineVisible: false
          });
          
          const lineData = [
            { time: this.candlesData[0].time, value: level.price },
            { time: this.candlesData[this.candlesData.length - 1].time, value: level.price }
          ];
          supportLine.setData(lineData);
          this.supportLineSeries.push(supportLine);
        });
        
        this.updateSupportResistancePanel();
      }
      
      findSignificantLevels(points, tolerance, minTouches) {
        const levels = [];
        const groupedPoints = {};
        
        points.forEach(point => {
          let foundGroup = false;
          for (let levelPrice in groupedPoints) {
            if (Math.abs(point.price - parseFloat(levelPrice)) / parseFloat(levelPrice) < tolerance) {
              groupedPoints[levelPrice].push(point);
              foundGroup = true;
              break;
            }
          }
          if (!foundGroup) {
            groupedPoints[point.price] = [point];
          }
        });
        
        for (let levelPrice in groupedPoints) {
          if (groupedPoints[levelPrice].length >= minTouches) {
            const avgPrice = groupedPoints[levelPrice].reduce((sum, p) => sum + p.price, 0) / groupedPoints[levelPrice].length;
            const touches = groupedPoints[levelPrice].length;
            const strength = Math.min(touches / 5, 1);
            
            levels.push({
              price: avgPrice,
              touches: touches,
              strength: strength,
              points: groupedPoints[levelPrice]
            });
          }
        }
        
        return levels.sort((a, b) => b.strength - a.strength).slice(0, 5);
      }
      
      updateSupportResistancePanel() {
        const panel = document.getElementById('support-resistance-panel');
        const levelsList = document.getElementById('levels-list');
        
        if (!this.settings.showSupportResistance) {
          panel.style.display = 'none';
          return;
        }
        
        panel.style.display = 'block';
        levelsList.innerHTML = '';
        
        // Add resistance levels
        this.resistanceLevels.forEach(level => {
          const levelDiv = document.createElement('div');
          levelDiv.className = 'level-item resistance';
          levelDiv.innerHTML = `
            <span>Res:</span>
            <span>$${level.price.toFixed(2)}</span>
          `;
          levelsList.appendChild(levelDiv);
        });
        
        // Add support levels
        this.supportLevels.forEach(level => {
          const levelDiv = document.createElement('div');
          levelDiv.className = 'level-item support';
          levelDiv.innerHTML = `
            <span>Sup:</span>
            <span>$${level.price.toFixed(2)}</span>
          `;
          levelsList.appendChild(levelDiv);
        });
      }
      
      updatePatternMarkers() {
        if (this.settings.showPatterns) {
          this.candleSeries.setMarkers(this.patterns);
        } else {
          this.candleSeries.setMarkers([]);
        }
      }
      
      updateSwingPointMarkers() {
        if (this.settings.showSwingPoints) {
          this.candleSeries.setMarkers(this.swingPoints);
        }
      }
      
      updateAllMarkers() {
        let allMarkers = [];
        
        if (this.settings.showPatterns) {
          allMarkers = [...allMarkers, ...this.patterns];
        }
        
        if (this.settings.showSwingPoints) {
          allMarkers = [...allMarkers, ...this.swingPoints];
        }
        
        this.candleSeries.setMarkers(allMarkers);
      }
      
      loadPatternDefinitions() {
        const patterns = [
          {
            name: 'Doji',
            type: 'doji',
            description: 'A candle where open and close are nearly equal, showing indecision in the market.',
            psychology: 'Neither bulls nor bears are in control. Often signals a potential reversal when found at key levels.',
            confirmation: 'Look for volume increase and follow-through in the next candle.',
            examples: 'Often appears at market tops and bottoms before significant reversals.'
          },
          {
            name: 'Bullish Engulfing',
            type: 'bullish_engulfing',
            description: 'A green candle completely engulfs the previous red candle.',
            psychology: 'Bulls have overwhelmed the bears, showing strong buying pressure.',
            confirmation: 'Higher volume and continuation of upward movement.',
            examples: 'Frequently seen at the end of downtrends, signaling potential reversal.'
          },
          {
            name: 'Bearish Engulfing',
            type: 'bearish_engulfing',
            description: 'A red candle completely engulfs the previous green candle.',
            psychology: 'Bears have overwhelmed the bulls, showing strong selling pressure.',
            confirmation: 'Higher volume and continuation of downward movement.',
            examples: 'Often appears at market tops, indicating potential trend reversal.'
          },
          {
            name: 'Hammer',
            type: 'hammer',
            description: 'A candle with a small body and long lower wick, appearing after a downtrend.',
            psychology: 'Sellers pushed price down but buyers stepped in, showing potential support.',
            confirmation: 'Next candle should close above the hammer\'s high.',
            examples: 'Effective reversal signal when found at key support levels.'
          },
          {
            name: 'Shooting Star',
            type: 'shooting_star',
            description: 'A candle with a small body and long upper wick, appearing after an uptrend.',
            psychology: 'Buyers pushed price up but sellers stepped in, showing potential resistance.',
            confirmation: 'Next candle should close below the shooting star\'s low.',
            examples: 'Strong reversal signal when found at key resistance levels.'
          },
          {
            name: 'Higher Highs (HH)',
            type: 'higher_high',
            description: 'A price peak that surpasses the previous high point, indicating upward momentum.',
            psychology: 'Buyers are in control and pushing prices to new highs, showing bullish strength.',
            confirmation: 'Look for sustained buying pressure and volume confirmation.',
            examples: 'Series of HH with HL confirms a strong uptrend and bullish market sentiment.'
          },
          {
            name: 'Lower Lows (LL)',
            type: 'lower_low',
            description: 'A price trough that falls below the previous low point, indicating downward momentum.',
            psychology: 'Sellers are in control and pushing prices to new lows, showing bearish weakness.',
            confirmation: 'Look for sustained selling pressure and volume confirmation.',
            examples: 'Series of LL with LH confirms a strong downtrend and bearish market sentiment.'
          },
          {
            name: 'Lower Highs (LH)',
            type: 'lower_high',
            description: 'A price peak that is lower than the previous high, indicating weakening upward momentum.',
            psychology: 'Bulls are losing control, unable to push prices to new highs, showing potential reversal.',
            confirmation: 'Combined with LL, confirms downtrend. Watch for breakdown below support.',
            examples: 'LH pattern often precedes trend reversals from bullish to bearish.'
          },
          {
            name: 'Higher Lows (HL)',
            type: 'higher_low',
            description: 'A price trough that is higher than the previous low, indicating strengthening upward momentum.',
            psychology: 'Bears are losing control, unable to push prices to new lows, showing potential reversal.',
            confirmation: 'Combined with HH, confirms uptrend. Watch for breakout above resistance.',
            examples: 'HL pattern often precedes trend reversals from bearish to bullish.'
          }
        ];
        
        this.populatePatternsList(patterns, 'patterns-list');
        this.populatePatternsList(patterns, 'patterns-list-mobile');
      }
      
      populatePatternsList(patterns, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = '';
        
        patterns.forEach(pattern => {
          const patternDiv = document.createElement('div');
          patternDiv.className = 'pattern-card rounded-lg p-4';
          patternDiv.dataset.type = pattern.type;
          
          patternDiv.innerHTML = `
            <div class="text-sm font-bold text-green-400 mb-2">${pattern.name}</div>
            <div class="text-xs text-gray-300 mb-2">${pattern.description}</div>
            <div class="text-xs text-gray-400 mb-1"><strong>Psychology:</strong> ${pattern.psychology}</div>
            <div class="text-xs text-gray-400 mb-1"><strong>Confirmation:</strong> ${pattern.confirmation}</div>
            <div class="text-xs text-gray-400"><strong>Examples:</strong> ${pattern.examples}</div>
          `;
          
          patternDiv.addEventListener('click', () => {
            this.highlightPattern(pattern.type);
          });
          
          container.appendChild(patternDiv);
        });
      }
      
      loadIndicatorDefinitions() {
        const indicators = [
          {
            name: 'Moving Averages (MA)',
            type: 'ma',
            description: 'Smoothed price lines that show the average price over a specific period.',
            usage: 'MA50 (blue) and MA200 (red) help identify trend direction. When MA50 crosses above MA200, it\'s often bullish.',
            interpretation: 'Price above MA = uptrend, price below MA = downtrend. Golden cross (50>200) is bullish, death cross (50<200) is bearish.',
            signals: 'Use for trend confirmation and dynamic support/resistance levels.'
          },
          {
            name: 'RSI (Relative Strength Index)',
            type: 'rsi',
            description: 'Momentum oscillator that measures the speed and magnitude of price changes (0-100).',
            usage: 'RSI above 70 suggests overbought conditions, below 30 suggests oversold conditions.',
            interpretation: 'Values above 70 may indicate selling opportunity, below 30 may indicate buying opportunity.',
            signals: 'Look for divergences between price and RSI for potential reversal signals.'
          },
          {
            name: 'MACD (Moving Average Convergence Divergence)',
            type: 'macd',
            description: 'Trend-following momentum indicator that shows the relationship between two moving averages.',
            usage: 'MACD line crossing above zero suggests bullish momentum, below zero suggests bearish momentum.',
            interpretation: 'Positive MACD = upward momentum, negative MACD = downward momentum.',
            signals: 'MACD line crossing signal line generates buy/sell signals. Histogram shows momentum strength.'
          },
          {
            name: 'Bollinger Bands',
            type: 'bollinger',
            description: 'Volatility bands placed above and below a moving average, expanding and contracting with volatility.',
            usage: 'Price touching upper band may indicate overbought, touching lower band may indicate oversold.',
            interpretation: 'Narrow bands = low volatility, wide bands = high volatility. Price tends to bounce between bands.',
            signals: 'Band squeezes often precede significant price moves. Breakouts above/below bands can signal trend continuation.'
          }
        ];
        
        this.populateIndicatorsList(indicators, 'indicators-list');
        this.populateIndicatorsList(indicators, 'indicators-list-mobile');
      }
      
      populateIndicatorsList(indicators, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = '';
        
        indicators.forEach(indicator => {
          const indicatorDiv = document.createElement('div');
          indicatorDiv.className = 'indicator-card rounded-lg p-4';
          indicatorDiv.dataset.type = indicator.type;
          
          indicatorDiv.innerHTML = `
            <div class="text-sm font-bold text-purple-400 mb-2">${indicator.name}</div>
            <div class="text-xs text-gray-300 mb-2">${indicator.description}</div>
            <div class="text-xs text-gray-400 mb-1"><strong>Usage:</strong> ${indicator.usage}</div>
            <div class="text-xs text-gray-400 mb-1"><strong>Interpretation:</strong> ${indicator.interpretation}</div>
            <div class="text-xs text-gray-400"><strong>Signals:</strong> ${indicator.signals}</div>
          `;
          
          indicatorDiv.addEventListener('click', () => {
            this.highlightIndicator(indicator.type);
          });
          
          container.appendChild(indicatorDiv);
        });
      }
      
      loadGlossary() {
        const glossaryTerms = [
          { term: 'Bull Market', definition: 'A market characterized by rising prices and optimistic sentiment.' },
          { term: 'Bear Market', definition: 'A market characterized by falling prices and pessimistic sentiment.' },
          { term: 'Support', definition: 'A price level where buying interest is strong enough to prevent further decline.' },
          { term: 'Resistance', definition: 'A price level where selling interest is strong enough to prevent further advance.' },
          { term: 'Higher High (HH)', definition: 'A price peak that surpasses the previous high point, indicating upward momentum.' },
          { term: 'Lower Low (LL)', definition: 'A price trough that falls below the previous low point, indicating downward momentum.' },
          { term: 'Lower High (LH)', definition: 'A price peak that is lower than the previous high, indicating weakening momentum.' },
          { term: 'Higher Low (HL)', definition: 'A price trough that is higher than the previous low, indicating strengthening momentum.' },
          { term: 'Uptrend', definition: 'A series of higher highs and higher lows, indicating bullish market sentiment.' },
          { term: 'Downtrend', definition: 'A series of lower highs and lower lows, indicating bearish market sentiment.' },
          { term: 'Volume', definition: 'The number of shares or contracts traded during a specific period.' },
          { term: 'Volatility', definition: 'The degree of price fluctuation in a security or market.' },
          { term: 'Liquidity', definition: 'The ease with which an asset can be bought or sold without affecting its price.' },
          { term: 'Trend', definition: 'The general direction of price movement over time.' },
          { term: 'Breakout', definition: 'When price moves beyond a defined support or resistance level.' },
          { term: 'Reversal', definition: 'A change in the direction of a price trend.' },
          { term: 'Long Position', definition: 'Buying an asset expecting its price to rise.' },
          { term: 'Short Position', definition: 'Selling an asset expecting its price to fall.' },
          { term: 'Stop Loss', definition: 'An order to sell a security when it reaches a certain price to limit losses.' },
          { term: 'Take Profit', definition: 'An order to sell a security when it reaches a certain price to secure gains.' }
        ];
        
        this.populateGlossaryList(glossaryTerms, 'glossary-list');
        this.populateGlossaryList(glossaryTerms, 'glossary-list-mobile');
      }
      
      populateGlossaryList(terms, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = '';
        
        terms.forEach(item => {
          const termDiv = document.createElement('div');
          termDiv.className = 'glossary-term';
          termDiv.innerHTML = `
            <div class="text-xs font-bold text-blue-400">${item.term}</div>
            <div class="text-xs text-gray-300 mt-1">${item.definition}</div>
          `;
          container.appendChild(termDiv);
        });
      }
      
      highlightPattern(patternType) {
        // Remove previous highlights
        document.querySelectorAll('.pattern-card').forEach(el => {
          el.classList.remove('highlighted');
        });
        
        // Highlight selected pattern
        const patternElements = document.querySelectorAll(`[data-type="${patternType}"]`);
        patternElements.forEach(el => {
          if (el.classList.contains('pattern-card')) {
            el.classList.add('highlighted');
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        });
        
        // Highlight patterns on chart
        let filteredMarkers = [];
        
        if (['higher_high', 'lower_low', 'lower_high', 'higher_low'].includes(patternType)) {
          filteredMarkers = this.swingPoints.filter(p => p.type === patternType);
        } else {
          filteredMarkers = this.patterns.filter(p => p.type === patternType);
        }
        
        this.candleSeries.setMarkers(filteredMarkers);
        
        // Reset after 3 seconds
        setTimeout(() => {
          this.updateAllMarkers();
          patternElements.forEach(el => {
            if (el.classList.contains('pattern-card')) {
              el.classList.remove('highlighted');
            }
          });
        }, 3000);
      }
      
      highlightIndicator(indicatorType) {
        // Remove previous highlights
        document.querySelectorAll('.indicator-card').forEach(el => {
          el.classList.remove('highlighted');
        });
        
        // Highlight selected indicator
        const indicatorElements = document.querySelectorAll(`[data-type="${indicatorType}"]`);
        indicatorElements.forEach(el => {
          if (el.classList.contains('indicator-card')) {
            el.classList.add('highlighted');
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        });
        
        // Temporarily show the indicator
        this.toggleIndicator(indicatorType, true);
        
        // Reset after 5 seconds
        setTimeout(() => {
          indicatorElements.forEach(el => {
            if (el.classList.contains('indicator-card')) {
              el.classList.remove('highlighted');
            }
          });
        }, 5000);
      }
      
      togglePatterns() {
        this.settings.showPatterns = !this.settings.showPatterns;
        this.updateButtonState('toggle-patterns', this.settings.showPatterns);
        this.updateAllMarkers();
      }
      
      toggleSwingPoints() {
        this.settings.showSwingPoints = !this.settings.showSwingPoints;
        this.updateButtonState('toggle-swing-points', this.settings.showSwingPoints);
        this.updateAllMarkers();
      }
      
      toggleSupportResistance() {
        this.settings.showSupportResistance = !this.settings.showSupportResistance;
        this.updateButtonState('toggle-support-resistance', this.settings.showSupportResistance);
        
        // Show/hide support and resistance lines
        this.supportLineSeries.forEach(series => {
          series.applyOptions({ visible: this.settings.showSupportResistance });
        });
        this.resistanceLineSeries.forEach(series => {
          series.applyOptions({ visible: this.settings.showSupportResistance });
        });
        
        this.updateSupportResistancePanel();
      }
      
      toggleIndicator(indicator, forceState = null) {
        const state = forceState !== null ? forceState : !this.settings[`show${indicator.charAt(0).toUpperCase() + indicator.slice(1)}`];
        this.settings[`show${indicator.charAt(0).toUpperCase() + indicator.slice(1)}`] = state;
        
        switch (indicator) {
          case 'ma':
            this.ma50Series.applyOptions({ visible: state });
            this.ma200Series.applyOptions({ visible: state });
            break;
          case 'volume':
            this.volumeSeries.applyOptions({ visible: state });
            break;
          case 'rsi':
            this.rsiSeries.applyOptions({ visible: state });
            break;
          case 'macd':
            this.macdSeries.applyOptions({ visible: state });
            break;
          case 'bollinger':
            this.bollingerUpperSeries.applyOptions({ visible: state });
            this.bollingerLowerSeries.applyOptions({ visible: state });
            break;
        }
        
        this.updateButtonState(`toggle-${indicator}`, state);
      }
      
      updateButtonState(buttonId, active) {
        const button = document.getElementById(buttonId);
        if (button) {
          if (active) {
            button.classList.add('active');
          } else {
            button.classList.remove('active');
          }
        }
      }
      
      updateCandleColors() {
        this.candleSeries.applyOptions({
          upColor: this.settings.bullColor,
          downColor: this.settings.bearColor,
          borderUpColor: this.settings.bullColor,
          borderDownColor: this.settings.bearColor,
          wickUpColor: this.settings.bullColor,
          wickDownColor: this.settings.bearColor
        });
      }
      
      toggleQuizMode() {
        this.quizMode = !this.quizMode;
        
        if (this.quizMode) {
          this.startQuiz();
        } else {
          this.exitQuizMode();
        }
      }
      
      startQuiz() {
        document.getElementById('quiz-overlay').style.display = 'flex';
        this.nextQuizQuestion();
      }
      
      nextQuizQuestion() {
        const allPatterns = [...this.patterns, ...this.swingPoints];
        const quizPatterns = allPatterns.filter(p => 
          ['doji', 'bullish_engulfing', 'bearish_engulfing', 'hammer', 'shooting_star', 
           'higher_high', 'lower_low', 'lower_high', 'higher_low'].includes(p.type)
        );
        
        if (quizPatterns.length === 0) {
          this.showAlert('No patterns found for quiz. Please wait for data to load.', 'error');
          return;
        }
        
        const randomPattern = quizPatterns[Math.floor(Math.random() * quizPatterns.length)];
        this.currentQuiz = randomPattern;
        
        // Highlight the pattern on chart
        this.candleSeries.setMarkers([randomPattern]);
        
        // Create quiz question
        const options = ['Doji', 'Bullish Engulfing', 'Bearish Engulfing', 'Hammer', 'Shooting Star', 
                        'Higher High (HH)', 'Lower Low (LL)', 'Lower High (LH)', 'Higher Low (HL)'];
        const correctAnswer = this.getPatternDisplayName(randomPattern.type);
        
        // Shuffle options
        const shuffledOptions = [...options].sort(() => Math.random() - 0.5);
        
        document.getElementById('quiz-question').textContent = `What pattern is highlighted on the chart?`;
        
        const optionsContainer = document.getElementById('quiz-options');
        optionsContainer.innerHTML = '';
        
        shuffledOptions.forEach(option => {
          const optionDiv = document.createElement('div');
          optionDiv.className = 'quiz-option';
          optionDiv.textContent = option;
          optionDiv.addEventListener('click', () => this.checkQuizAnswer(option, correctAnswer));
          optionsContainer.appendChild(optionDiv);
        });
      }
      
      checkQuizAnswer(selected, correct) {
        const options = document.querySelectorAll('.quiz-option');
        options.forEach(option => {
          if (option.textContent === correct) {
            option.classList.add('correct');
          } else if (option.textContent === selected && selected !== correct) {
            option.classList.add('incorrect');
          }
          option.style.pointerEvents = 'none';
        });
        
        setTimeout(() => {
          options.forEach(option => {
            option.classList.remove('correct', 'incorrect');
            option.style.pointerEvents = 'auto';
          });
        }, 2000);
      }
      
      getPatternDisplayName(type) {
        const names = {
          'doji': 'Doji',
          'bullish_engulfing': 'Bullish Engulfing',
          'bearish_engulfing': 'Bearish Engulfing',
          'hammer': 'Hammer',
          'shooting_star': 'Shooting Star',
          'higher_high': 'Higher High (HH)',
          'lower_low': 'Lower Low (LL)',
          'lower_high': 'Lower High (LH)',
          'higher_low': 'Higher Low (HL)'
        };
        return names[type] || type;
      }
      
      exitQuizMode() {
        this.quizMode = false;
        document.getElementById('quiz-overlay').style.display = 'none';
        this.updateAllMarkers();
      }
      
      toggleTradingPanel() {
        this.tradingActive = !this.tradingActive;
        const panel = document.getElementById('trading-panel');
        panel.style.display = this.tradingActive ? 'block' : 'none';
        this.updateButtonState('toggle-trading', this.tradingActive);
        
        if (this.tradingActive) {
          this.updateTradingDisplay();
        }
      }
      
      executeTrade(type) {
        if (!this.candlesData.length || this.position) return;
        
        const currentPrice = this.candlesData[this.candlesData.length - 1].close;
        
        this.position = type;
        this.entryPrice = currentPrice;
        this.positionSize = Math.floor(this.balance / currentPrice * 0.95);
        
        this.updateTradingDisplay();
        this.updateTradingButtons();
      }
      
      closePosition() {
        if (!this.position || !this.candlesData.length) return;
        
        const currentPrice = this.candlesData[this.candlesData.length - 1].close;
        let pnl = 0;
        
        if (this.position === 'long') {
          pnl = (currentPrice - this.entryPrice) * this.positionSize;
        } else if (this.position === 'short') {
          pnl = (this.entryPrice - currentPrice) * this.positionSize;
        }
        
        this.balance += pnl;
        this.position = null;
        this.entryPrice = 0;
        this.positionSize = 0;
        
        this.updateTradingDisplay();
        this.updateTradingButtons();
        
        // Show trade result
        const result = pnl >= 0 ? 'Profit' : 'Loss';
        this.showAlert(`Position closed! ${result}: $${pnl.toFixed(2)}`, pnl >= 0 ? 'success' : 'error');
      }
      
      resetTradingAccount() {
        this.balance = 10000;
        this.position = null;
        this.entryPrice = 0;
        this.positionSize = 0;
        
        this.updateTradingDisplay();
        this.updateTradingButtons();
        
        this.showAlert('Trading account reset to $10,000', 'success');
      }
      
      updateTradingDisplay() {
        document.getElementById('balance').textContent = this.balance.toFixed(2);
        document.getElementById('position').textContent = this.position ? this.position.toUpperCase() : 'None';
        document.getElementById('entry-price').textContent = this.entryPrice.toFixed(2);
        
        if (this.position && this.candlesData.length) {
          const currentPrice = this.candlesData[this.candlesData.length - 1].close;
          let pnl = 0;
          
          if (this.position === 'long') {
            pnl = (currentPrice - this.entryPrice) * this.positionSize;
          } else if (this.position === 'short') {
            pnl = (this.entryPrice - currentPrice) * this.positionSize;
          }
          
          const pnlElement = document.getElementById('pnl');
          pnlElement.textContent = pnl.toFixed(2);
          pnlElement.className = pnl >= 0 ? 'pnl-positive' : 'pnl-negative';
        } else {
          const pnlElement = document.getElementById('pnl');
          pnlElement.textContent = '0.00';
          pnlElement.className = '';
        }
      }
      
      updateTradingButtons() {
        const buyBtn = document.getElementById('buy-btn');
        const sellBtn = document.getElementById('sell-btn');
        const closeBtn = document.getElementById('close-position-btn');
        
        if (this.position) {
          buyBtn.disabled = true;
          sellBtn.disabled = true;
          closeBtn.disabled = false;
        } else {
          buyBtn.disabled = false;
          sellBtn.disabled = false;
          closeBtn.disabled = true;
        }
      }
      
      onCrosshairMove(param) {
        if (!param.point) {
          document.getElementById('tooltip').style.display = 'none';
          document.getElementById('indicator-values').style.display = 'none';
          return;
        }
        
        // Show pattern tooltip
        const allMarkers = [...this.patterns, ...this.swingPoints];
        const marker = allMarkers.find(p => p.time === param.time);
        if (marker) {
          this.showTooltip(marker.text, param.point.x, param.point.y);
        } else {
          document.getElementById('tooltip').style.display = 'none';
        }
        
        // Show indicator values
        this.showIndicatorValues(param);
        
        // Update trading display if active
        if (this.tradingActive) {
          this.updateTradingDisplay();
        }
      }
      
      onChartClick(param) {
        if (!param.time) return;
        
        const allMarkers = [...this.patterns, ...this.swingPoints];
        const marker = allMarkers.find(p => p.time === param.time);
        if (marker) {
          this.highlightPattern(marker.type);
        }
      }
      
      showTooltip(text, x, y) {
        const tooltip = document.getElementById('tooltip');
        tooltip.textContent = text;
        tooltip.style.left = `${x + 10}px`;
        tooltip.style.top = `${y + 10}px`;
        tooltip.style.display = 'block';
      }
      
      showIndicatorValues(param) {
        const indicatorValues = document.getElementById('indicator-values');
        
        if (this.settings.showRsi || this.settings.showMacd) {
          let content = '';
          
          if (this.settings.showRsi) {
            // Find RSI value for current time
            const rsiData = this.rsiSeries.data();
            const rsiValue = rsiData.find(d => d.time === param.time);
            if (rsiValue) {
              content += `<div class="flex items-center space-x-2"><i class="fas fa-bolt text-yellow-400"></i><span>RSI: ${rsiValue.value.toFixed(2)}</span></div>`;
            }
          }
          
          if (this.settings.showMacd) {
            // Find MACD value for current time
            const macdData = this.macdSeries.data();
            const macdValue = macdData.find(d => d.time === param.time);
            if (macdValue) {
              content += `<div class="flex items-center space-x-2"><i class="fas fa-water text-purple-400"></i><span>MACD: ${macdValue.value.toFixed(4)}</span></div>`;
            }
          }
          
          if (content) {
            indicatorValues.innerHTML = content;
            indicatorValues.style.display = 'block';
          }
        } else {
          indicatorValues.style.display = 'none';
        }
      }
      
      saveSettings() {
        localStorage.setItem('bitcoinChartSettings', JSON.stringify(this.settings));
        this.showAlert('Settings saved successfully!', 'success');
      }
      
      loadSettings() {
        const saved = localStorage.getItem('bitcoinChartSettings');
        return saved ? JSON.parse(saved) : {
          timeframe: '1h',
          bullColor: '#10b981',
          bearColor: '#ef4444',
          showPatterns: true,
          showSwingPoints: false,
          showSupportResistance: false,
          showMa: false,
          showVolume: false,
          showRsi: false,
          showMacd: false,
          showBollinger: false
        };
      }
      
      applySettings() {
        // Apply timeframe
        document.getElementById('timeframe-select').value = this.settings.timeframe;
        
        // Apply colors
        document.getElementById('bull-color').value = this.settings.bullColor;
        document.getElementById('bear-color').value = this.settings.bearColor;
        
        // Apply button states
        this.updateButtonState('toggle-patterns', this.settings.showPatterns);
        this.updateButtonState('toggle-swing-points', this.settings.showSwingPoints);
        this.updateButtonState('toggle-support-resistance', this.settings.showSupportResistance);
        this.updateButtonState('toggle-ma', this.settings.showMa);
        this.updateButtonState('toggle-volume', this.settings.showVolume);
        this.updateButtonState('toggle-rsi', this.settings.showRsi);
        this.updateButtonState('toggle-macd', this.settings.showMacd);
        this.updateButtonState('toggle-bollinger', this.settings.showBollinger);
        
        // Initialize trading buttons
        this.updateTradingButtons();
      }
    }
    
    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
      window.chartAcademy = new BitcoinChartAcademy();
    });
  </script>
</body>
</html>
